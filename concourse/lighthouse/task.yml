---
platform: linux

image_resource:
  type: docker-image
  source:
    password: ((dockerhub-password))
    username: ((dockerhub-username))
    repository: openstax/rex-web
    tag: CI-2023-08-10

inputs:
- name: rex-web
- name: previous-lighthouse-report
outputs:
- name: lighthouse-report

params:
  AWS_ACCESS_KEY_ID: ((prod-aws-access-key-id))
  AWS_SECRET_ACCESS_KEY: ((prod-aws-secret-access-key))
  LIGHTHOUSE_PAGES: ((lighthouse-pages))
  LIGHTHOUSE_PREVIOUS_REPORT_DIR: previous-lighthouse-report
  LIGHTHOUSE_REPORT_DIR: lighthouse-report

run:
  path: /bin/deno
  args:
    - run
    - --allow-read
    - --allow-write
    - --allow-net
    - --allow-env
    - rex-web/concourse/lighthouse/script.deno.ts
